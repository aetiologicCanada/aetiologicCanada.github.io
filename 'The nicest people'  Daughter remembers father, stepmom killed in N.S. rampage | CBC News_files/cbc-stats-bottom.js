"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var CBC;window.CBC||(window.CBC={}),CBC.APP||(CBC.APP={}),CBC.APP.versions||(CBC.APP.versions={}),CBC.APP.versions["cbc-stats-bottom"]="2.60.0",window.CBC||(window.CBC={}),CBC.APP||(CBC.APP={}),CBC.APP.SC||(CBC.APP.SC={}),CBC.APP.SC.Detectizr=function(e){var t=e||(window.navigator.userAgent||window.navigator.vendor||window.opera).toLowerCase();function i(e){return e.test(t)}function n(e){return-1<t.indexOf(e)}function r(e){return e.exec(t)}function a(e,t){var i=(e.version=t).split(".");0<i.length?(i=i.reverse(),e.major=i.pop(),0<i.length?(e.minor=i.pop(),0<i.length?(i=i.reverse(),e.patch=i.join(".")):e.patch="0"):e.minor="0"):e.major="0"}var o={type:"",model:""},s={},c=["tv","tablet","mobile","desktop"];return i(/googletv|smarttv|smart-tv|internet.tv|netcast|nettv|appletv|boxee|kylo|dlnadoc|roku|pov_tv|hbbtv|ce-html/)?(o.type=c[0],o.model="smartTv"):i(/xbox|playstation.3|wii/)?(o.type=c[0],o.model="gameConsole"):i(/ip(a|ro)d/)?(o.type=c[1],o.model="ipad"):i(/tablet/)&&!i(/rx-34/)||i(/folio/)?(o.type=c[1],o.model=String(r(/playbook/)||"")):i(/linux/)&&i(/android/)&&!i(/fennec|mobi|htc.magic|htcX06ht|nexus.one|sc-02b|fone.945/)?(o.type=c[1],o.model="android"):i(/kindle/)||i(/mac.os/)&&i(/silk/)?(o.type=c[1],o.model="kindle"):i(/gt-p10|sc-01c|shw-m180s|sgh-t849|sch-i800|shw-m180l|sph-p100|sgh-i987|zt180|htc(.flyer|_flyer)|sprint.atp51|viewpad7|pandigital(sprnova|nova)|ideos.s7|dell.streak.7|advent.vega|a101it|a70bht|mid7015|next2|nook/)||i(/mb511/)&&i(/rutem/)?(o.type=c[1],o.model="android"):i(/bb10/)?(o.type=c[1],o.model="blackberry"):(o.model=r(/iphone|ipod|android|blackberry|opera mini|opera mobi|skyfire|maemo|windows phone|palm|iemobile|symbian|symbianos|fennec|j2me/),null!==o.model?(o.type=c[2],o.model=String(o.model)):(o.model="",i(/bolt|fennec|iris|maemo|minimo|mobi|mowser|netfront|novarra|prism|rx-34|skyfire|tear|xv6875|xv6975|google.wireless.transcoder/)||i(/opera/)&&i(/windows.nt.5/)&&i(/htc|xda|mini|vario|samsung-gt-i8000|samsung-sgh-i9/)?o.type=c[2]:i(/windows.(nt|xp|me|9)/)&&!i(/phone/)||i(/win(9|.9|nt)/)||i(/\(windows 8\)/)?o.type=c[3]:i(/macintosh|powerpc/)&&!i(/silk/)?(o.type=c[3],o.model="mac os"):i(/cros/)?o.type=c[3]:o.type=c[2])),""!==o.model&&("ipad"===o.model||"iphone"===o.model||"ipod"===o.model?(s.name="ios",a(s,(i(/os\s([\d_]+)/)?RegExp.$1:"").replace(/_/g,"."))):"android"===o.model?(s.name="android",a(s,i(/android\s([\d.]+)/)?RegExp.$1:"")):"blackberry"===o.model?(s.name="blackberry",a(s,i(/version\/([^\s]+)/)?RegExp.$1:"")):"playbook"===o.model&&(s.name="blackberry",a(s,i(/os ([^\s]+)/)?RegExp.$1.replace(";",""):""))),s.name||(n("win")||n("16bit")?(s.name="windows",n("windows nt 10")?a(s,"10"):n("windows nt 6.3")?a(s,"8.1"):n("windows nt 6.2")||i(/\(windows 8\)/)?a(s,"8"):n("windows nt 6.1")?a(s,"7"):n("windows nt 6.0")?a(s,"vista"):(n("windows nt 5.2")||n("windows nt 5.1")||n("windows xp"))&&a(s,"xp")):n("mac")||n("darwin")?(s.name="mac os",n("os x")&&a(s,(i(/os\sx\s([\d_]+)/)?RegExp.$1:"os x").replace(/_/g,"."))):n("webtv")?s.name="webtv":(n("x11")||n("inux"))&&(s.name="linux")),{os:s,device:o,ua:t}},window.Detectizr=CBC.APP.SC.Detectizr(),(CBC=CBC||{}).APP=CBC.APP||{},function(){if(!CBC.APP.PubSub){var e=function(){function n(e,t,i){_classCallCheck(this,n),this.subscribers=e||{},this.queuedEvents=t||[],this.isOn=i||!1}return _createClass(n,[{key:"turnOn",value:function(){if(this.isOn=!0,0<this.queuedEvents.length)for(var e=0;e<this.queuedEvents.length;e++)this.publish(this.queuedEvents[e].event,this.queuedEvents[e].payload),this.queuedEvents.splice(e,1)}},{key:"turnOff",value:function(){this.isOn=!1}},{key:"isOn",value:function(){return this.isOn}},{key:"publish",value:function(t,i){t in this.subscribers?this.subscribers[t].slice().forEach(function(e){try{e(t,i)}catch(e){console.error(e.message)}}):this.isOn||this.queuedEvents.push({event:t,payload:i})}},{key:"subscribe",value:function(e,t){return e in this.subscribers||(this.subscribers[e]=[]),this.subscribers[e].some(function(e){if(t===e)return!0})?(console.log("callback already exists for event:",e,t),!1):(this.subscribers[e].push(t),!0)}},{key:"unsubscribe",value:function(e,n){e in this.subscribers&&this.subscribers[e].some(function(e,t,i){if(n===e)return i.splice(t,1),!0})}}]),n}();CBC.APP.PubSub=new e}}(),(CBC=CBC||{}).APP=CBC.APP||{},CBC.APP.SC=CBC.APP.SC||{},CBC.APP.SC.viafouraSubscribed=!1,function(){function e(){CBC.APP.SC.viafouraSubscribed||(CBC.APP.SC.DEBUG&&console.log("Subscribing to Viafoura events"),window.vf.$subscribe("share","clicked",function(e,t){var i={network:e,elem:t};CBC.APP.SC.EventTracker.trackEvent("SHARED",i)}),window.vf.$subscribe("logout","success",function(){CBC.APP.SC.EventTracker.trackEvent("SIGNED OUT",{})}),window.vf.$subscribe("login","success",function(e){e&&1==e.isNewUser?CBC.APP.SC.EventTracker.trackEvent("SIGNED IN",{feature:{name:"sign-up-form"}}):CBC.APP.SC.EventTracker.trackEvent("SIGNED IN",{})}),window.vf.$subscribe("comment","created",function(e){CBC.APP.SC.EventTracker.trackEvent("COMMENTED",{})}),window.vf.$subscribe("comment-reply","posted",function(e){CBC.APP.SC.EventTracker.trackEvent("COMMENTED",{})}),CBC.APP.SC.viafouraSubscribed=!0,CBC.APP.PubSub.publish("viafouraAvailable",{}))}void 0!==window.vf?e():(window.vfQ=window.vfQ||[],window.vfQ.push(e)),CBC.APP.PubSub.subscribe("loadedAudiences",function e(){if(CBC.APP.DMP.LOTAME&&CBC.APP.DMP.LOTAME.audiences&&CBC.APP.DMP.LOTAME.audiences.Profile&&CBC.APP.DMP.LOTAME.audiences.Profile.Audiences&&CBC.APP.DMP.LOTAME.audiences.Profile.Audiences.Audience&&0<CBC.APP.DMP.LOTAME.audiences.Profile.Audiences.Audience.length){var t=CBC.APP.DMP.LOTAME.audiences.Profile.Audiences.Audience.filter(function(e){return e.id}).map(function(e){return e.id});0<t.length&&(CBC.APP.SC.EventTracker.mUP("set","user.segments.dmp.ids",t),CBC.APP.PubSub.unsubscribe("loadedAudiences",e))}})}(),function(){function e(e){var t=e=e.replace(":","");try{for(var i=0;i<100&&t!=(e=decodeURIComponent(e))&&!e.match(/^http(s)?\:/);i++)t=e}catch(e){}return e.replace(/(^\s+|\s+$)/g,"")}try{var a=function(e,t,i,n){return e[t]===n&&0===i||e[i]===n&&0===t};if(!location||!location.hostname||!location.pathname)return;var t,i,n,r,o=document.location.hostname.replace(/^www\./,""),s=function(){for(var e,t,i=document.getElementsByTagName("meta"),n=0,r=i.length;n<r;n++)if("og:title"===(t=i[n]).getAttribute("property")){e=t.getAttribute("content");break}return e=e||(document.title||"Untitled")}(),c=(T=s,(B=c={}).l1=o,B.l2=T,B.l3="__page__",B.l4="-",B),u=(new Date).getTime(),d=Math.floor(Math.random()*Math.pow(10,12));t=(i=function(){for(var e=[64],t=1;t<=3;t++)e.push(64+t),e.push(64-t);return{b:e=e[Math.floor(Math.random()*e.length)],a:0==Math.floor(Math.random()*e)}}()).a?i.b:0,c.zmoatab_cm=t,c.t=u,c.de=d,c.zMoatAB_SNPT=!0,n=t||1,r=!i||!!i.a;o=[];var l,C=(new Date).getTime().toString(35),p=[e(c.l1),e(c.l2),e(c.l3),e(c.l4)].join(":"),h=(s=/zct[a-z0-9]+/i,"");for(l in c)c.hasOwnProperty(l)&&l.match(s)&&(h+="&"+l+"="+c[l]);var g=document.referrer.match(/^([^:]{2,}:\/\/[^\/]*)/),P=g?g[1]:document.referrer,b=["e=17","d="+encodeURIComponent(p),"de="+d,"t="+u,"i=CBCCONTENT2","cm="+n,String("j="+encodeURIComponent(P)+h),"mp=1","ac=1","pl=1","bq=10","vc=2"],f=(C="https://5j8ujmnywdoc-a.akamaihd.net/"+C+".gif?")+(f=function(e){for(var t="",i=0;i<e.length;i++)t+=(0===i?"":"&")+e[i];return t}(function(e){for(var t=0;t<e.length;t++){var i=Math.floor(Math.random()*(e.length-t)+t),n=e[t],r=a(e,t,i,b[1]);a(e,t,i,b[0])||r?t--:(e[t]=e[i],e[i]=n)}return e}(b)))+"&cs=0",m="https://px.moatads.com/pixel.gif?e=17&d="+encodeURIComponent(p)+"&de="+d+"&t="+u+"&i=CBCCONTENT2&cm="+n+"&j="+encodeURIComponent(P)+h+"&mp=0&ac=1&pl=1&bq=10&ad_type=img&vc=2&cs=0",v="https://px.moatads.com/pixel.gif?e=17&d="+encodeURIComponent(p)+"&de="+d+"&t="+u+"&i=CBCCONTENT2&cm="+n+"&j="+encodeURIComponent(P)+h+"&ku=1&ac=1&pl=1&bq=10&ad_type=img&vc=2&cs=0";for(var A in r&&((new Image).src=f,(new Image).src=m),c)o.push(A+"="+encodeURIComponent(c[A]));o=(o=o.join("&"))+"&vc=2";var S=document.createElement("script");S.type="text/javascript",S.async=!0,r&&(S.onerror=function(){(new Image).src=v});var w=document.getElementsByTagName("script")[0];w.parentNode.insertBefore(S,w),S.src="https://z.moatads.com/cbc907UvMO43/moatcontent.js#"+o}catch(e){try{var y="//pixel.moatads.com/pixel.gif?e=24&d=data%3Adata%3Adata%3Adata&i=MOATCONTENTABSNIPPET1"+h+"&vc=2&ac=1&k="+encodeURIComponent(e)+"&j="+encodeURIComponent(P)+"&cs="+(new Date).getTime();(new Image).src=y}catch(e){}}var B,T}(),window._sf_endpt=(new Date).getTime(),window.CBC||(window.CBC={}),CBC.APP||(CBC.APP={}),CBC.APP.COMSCORE||(CBC.APP.COMSCORE={}),CBC.APP.COMSCORE={useBeacon:!1,payload:{c1:2,c2:3005684},dataStructure:{},Call:function(){if(CBC.APP.SC.DTM.formatted.comscore&&(this.dataStructure=CBC.APP.SC.DTM.formatted.comscore),this.useBeacon)this.pvCandidate();else{this.useBeacon=!0;var e="",t={};if(0<Object.keys(this.dataStructure).length){if(this.dataStructure.syndicate&&"gamp"===this.dataStructure.syndicate)return!1;e=this.getC6(),t=this.getOptions()}var i={c3:"",c4:escape(window.location.href),c5:"CBC.ca-CanadianNewsSportsEntertainmentKidsDocsRadioTV",c6:e,c15:"",options:t},n=window._comscore||[];n.push(this.generatePayload(i,this.payload)),window._comscore=n,this.pvCandidate();var r=document.createElement("script"),a=document.getElementsByTagName("script")[0];r.async=!0,r.src="https://sb.scorecardresearch.com/beacon.js",a.parentNode.insertBefore(r,a)}},getC6:function(){var e="";return this.dataStructure.subsection3?e=this.dataStructure.subsection3:this.dataStructure.subsection2?e=this.dataStructure.subsection2:this.dataStructure.subsection1&&(e=this.dataStructure.subsection1),e},getOptions:function(){var e={};if(this.dataStructure.syndicate&&"fia"===this.dataStructure.syndicate)e={url_append:"comscorekw=fbia"};else if(this.useBeacon&&this.dataStructure.contentarea&&"homepage"!==this.dataStructure.contentarea){var t=this.dataStructure.contentarea,i=this.dataStructure.subsection1,n=t;"news"===t&&i&&(n=i),e={url_append:"comscorekw=".concat(n)}}if(document.getElementById("comscore-comment-div")&&document.getElementById("comscore-comment-div").remove(),e.url_append){var r=document.createElement("div"),a=document.createComment("comScore Identifier: ".concat(e.url_append));r.id="comscore-comment-div",r.appendChild(a),document.body.appendChild(r)}return e},generatePayload:function(e,t){return Object.assign({},e,t)},pvCandidate:function(){var e=this.getOptions();window.COMSCORE&&window.COMSCORE.beacon(this.generatePayload(this.payload,{options:e}));var t=void 0!==e.url_append?e.url_append+"&":"";CBC.APP.SC.UTIL.makeGETRequest("//www.cbc.ca/g/stats/comscore.json?".concat(t,"cache=").concat((new Date).getTime()),{success:function(e){JSON.parse(e.responseText).comscore||console.log("COMSCORE-bottom: json response error")},failure:function(){console.log("COMSCORE-bottom: json request error")}},{success:{success:!0},failure:{success:!1}})}},window.CBC||(window.CBC={}),CBC.APP||(CBC.APP={}),CBC.APP.CXENSE||(CBC.APP.CXENSE={addMetaTags:function(){for(var e=document.querySelectorAll("meta[name^=cXenseParse]"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t]);var i,n=CBC.APP.SC.DTM.formatted.cxense,r=document.querySelector("head");if(n&&n.contenttype){var a="article";"index"===n.contenttype&&(a="frontpage",n.contentarea&&/(video|kids|tv)/i.test(n.contentarea)&&(a="article","video"!==n.contentarea||n.contentid||(a="frontpage"),n.subsection1&&/(index|search)/i.test(n.subsection1)&&(a="frontpage")));var o=this.createMetaTag("cXenseParse:","pageclass",a);r.appendChild(o)}if(n&&n.contenttype&&"index"===n.contenttype&&n.contentarea&&/(video|kids|tv|life)/i.test(n.contentarea))if(n.pillar&&"legacyee"===n.pillar){i=n.subsection2?n.subsection2.replace(/[^a-zA-Z0-9"]/g," "):"",i+=n.subsection3&&"home"!==n.subsection3?" "+n.subsection3.replace(/[^a-zA-Z0-9"]/g," "):"";var s=this.createMetaTag("cXenseParse:","cbc-keymatch",i);r.appendChild(s)}else if("video"===n.contentarea&&n.contentid){i=n.subsection3?n.subsection3.replace(/[^a-zA-Z0-9"]/g," "):"";var c=this.createMetaTag("cXenseParse:","cbc-keymatch",i);r.appendChild(c)}for(var u in n)if({}.hasOwnProperty.call(n,u)){var d=this.createMetaTag("cXenseParse:cbc-",u,n[u]);if(r.appendChild(d),"publishedTime"===u&&!isNaN(parseInt(n[u]))){var l=this.createMetaTag("article:","published_time",new Date(parseInt(n[u])).toISOString(),"property");r.appendChild(l)}if("updatedTime"===u&&!isNaN(parseInt(n[u]))){var C=this.createMetaTag("article:","modified_time",new Date(parseInt(n[u])).toISOString(),"property");r.appendChild(C)}}},createMetaTag:function(e,t,i,n){var r=3<arguments.length&&void 0!==n?n:"name",a=document.createElement("meta");return a.setAttribute(r,e+t),a.setAttribute("content",i),a},pageView:function(){CBC.APP.CXENSE.addMetaTags(),window.cX.callQueue.push(["sendPageViewEvent"])}}),function(){var e,t,i,n;window.cX=window.cX||{},window.cX.callQueue=window.cX.callQueue||[],window.cX.callQueue.push(["setSiteId","9222369215399074873"]),e=document,t="script",(i=e.createElement(t)).type="text/java"+t,i.async="async",i.src="https://scdn.cxense.com/cx.js",(n=e.getElementsByTagName(t)[0]).parentNode.insertBefore(i,n)}(),function(){function i(i,n){if(void 0!==CBC.APP.SC.DTM.formatted.googlecloud&&(n=CBC.APP.SC.DTM.formatted.googlecloud),"READ"!==i.toUpperCase()||!n||!n.content||n.content.id&&"comments"!==n.content.type){var c=CBC.APP.SC.UTIL.getCookie("cbc_plus"),u=CBC.APP.SC.UTIL.getCookie("cbc_visitor");try{CBC.APP.SC.masterSwitch.switches.googlecloud&&(/ess/.test(CBC.APP.SC.masterSwitch.googlecloud.url)?d(CBC.APP.SC.masterSwitch.googlecloud.url,i,n,0):r(CBC.APP.SC.masterSwitch.googlecloud.url,i,n))}catch(e){var t="//www.cbc.ca/network/includes/stats/master-switch.json";CBC.APP.SC.UTIL.makeGETRequest(t,{success:function(e){var t=JSON.parse(e.responseText);t.switches.googlecloud&&(/ess/.test(t.googlecloud.url)?d(t.googlecloud.url,i,n,0):r(t.googlecloud.url,i,n))},failure:function(e,t){console.log("ERROR: Unable to talk to config URL: "+t.failure.uri)}},{success:{uri:t},failure:{uri:t}})}}function d(i,n,r,e){if(!r.content.id)return!1;var a=e,o=(new Map).set(500,!0).set(502,!0).set(503,!0).set(504,!0),t=(new Map).set("READ",["Read","E0406C","PolopolyArticle",r.content.id]).set("WATCHED",["Watched","WATCHED_PREDICATE_ID","MPXVideo","Replace_With_MPX_Video_ID"]).set("LISTENED",["Listened","LISTENED_PREDICATE_ID","AudioDB","Replace_With_AudioDB_ID"]),s={subject:{}};return s.subject.type="User",s.subject.id=c||u,!!s.subject.id&&(s.predicate={},s.predicate.type=t.get(n.toUpperCase())[0],s.predicate.id=t.get(n.toUpperCase())[1],s.predicate.end=(new Date).toISOString(),s.object={},s.object.type=t.get(n.toUpperCase())[2],s.object.id=t.get(n.toUpperCase())[3],!(!JSON.stringify(s)||"{}"===JSON.stringify(s))&&void CBC.APP.SC.UTIL.makePOSTRequest(i,JSON.stringify(s),{success:function(){},failure:function(e,t){o.has(e.status)&&a<3?(++a,setTimeout(function(){d(i,n,r,a)},2e3)):o.has(e.status)&&3<=a?(console.log("ERROR: ESS Server too busy or overloaded."),console.log("    URL: "+t.failure.uri),console.log("    Payload: "+JSON.stringify(t.failure.payload))):400===e.status?(console.log("ERROR: Missing or malformed ESS Payload."),console.log("    Payload: "+JSON.stringify(t.failure.payload))):(console.log("ERROR: Unable to talk to ESS Enpoint."),console.log("    URL: "+t.failure.uri))}},{success:{uri:i},failure:{payload:s,uri:i}},null,{"Content-Type":"application/json"}))}function r(e,t,i){(i=i||{}).user||(i.user={}),i.session||(i.session={}),i.verb=t,u&&(i.user.cbc_visitor=u),c&&(i.user.cbc_plus=c),i.session.startTime=CBC.APP.SC.EventTracker.sessionStartTime,CBC.APP.SC.UTIL.makePOSTRequest(e,JSON.stringify(i),{success:function(){},failure:function(e){console.log("ERROR: Unable to talk to RecSys URL: "+e.failure.uri)}},{success:{uri:e},failure:{uri:e}},null,{"Content-Type":"application/json"})}}function n(e,t){void 0!==CBC.APP.SC.DTM.formatted.googlecloud&&"READ"==e&&(t=CBC.APP.SC.DTM.formatted.googlecloud),"STREAMED"===e&&t.content?"video"===t.content.area||t.content.media&&"video"===t.content.media.audiovideo?window.CBC.APP.AB.Testing.sendGoal("api-streamed-video",1):("audio"===t.content.area||t.content.media&&"audio"===t.content.media.audiovideo)&&window.CBC.APP.AB.Testing.sendGoal("api-streamed-audio",1):"READ"===e&&t.content&&"comments"===t.content.type&&window.CBC.APP.AB.Testing.sendGoal("api-read-comment",1)}function r(e){e.user&&e.user.id&&e.user.id.gem&&(CBC.APP.SC.DTM.DATA.user||(CBC.APP.SC.DTM.DATA.user={},CBC.APP.SC.DTM.DATA.user.id={}),CBC.APP.SC.DTM.DATA.user.id.gem=e.user.id.gem,CBC.APP.SC.UTIL.sendGemID(CBC.APP.SC.UTIL.createUIEPayload()))}CBC.APP.PubSub.subscribe("SIGNED IN",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t),CBC.APP.SC.DTM.DATA.authenticated=CBC.APP.SC.PageTracker.isLoggedIn(),CBC.APP.SC.UTIL.setFormattedLayer(),r(t)}),CBC.APP.PubSub.subscribe("SIGNED OUT",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t),CBC.APP.SC.DTM.DATA.authenticated=CBC.APP.SC.PageTracker.isLoggedIn(),CBC.APP.SC.UTIL.setFormattedLayer(),CBC.APP.SC.UTIL.removeCBCPlusID(),r(t)}),CBC.APP.PubSub.subscribe("READ",function(e,t){n("READ",{}),i("READ",t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("STREAMED",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t),n("STREAMED",t),r(t)}),CBC.APP.PubSub.subscribe("SUBSCRIBED",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t),r(t)}),CBC.APP.PubSub.subscribe("UNSUBSCRIBED",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t),r(t)})}(),CBC.APP.PubSub.subscribe("CLOSED",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("COMMENTED",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("LISTENED",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("LOADED",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("LOADED MORE",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("NEXT",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("OPENED",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("PREVIOUS",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("SEARCHED",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("SELECTED",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("SET PREFERENCE",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("SHARED",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("START WEB SESSION",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("SUBMITTED",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("VIEWED AD",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("WATCHED",function(e,t){CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),window.CBC=window.CBC||{},(CBC=window.CBC).APP=CBC.APP||{},CBC.APP.ANA=CBC.APP.ANA||{},CBC.APP.ANA.VALIDATORS=CBC.APP.ANA.VALIDATORS||{},CBC.APP.ANA.VALIDATORS.Common={validateAppName:function(e){return CBC.APP.SC.UTIL.getMetadataWhitelist().metadata.whitelist.app.name[e]}},window.CBC=window.CBC||{},(CBC=window.CBC).APP=CBC.APP||{},CBC.APP.ANA=CBC.APP.ANA||{},CBC.APP.ANA.VALIDATORS=CBC.APP.ANA.VALIDATORS||{},CBC.APP.ANA.VALIDATORS.FBPIXEL={restrictKidsURL:function(){return/(cbc)?kids(cbc2|news|fantasyhockey)?/.test(CBC.APP.SC.UTIL.returnURL())},validateFacebookLibrary:function(){CBC.APP.SC.UTIL.masterSwitchMetaPromise().then(function(e){e.switches.facebook&&!CBC.APP.ANA.VALIDATORS.FBPIXEL.restrictKidsURL()?CBC.APP.ANA.LIBRARY.FBPIXEL.facebookLibrary():CBC.APP.SC.LinkTracker.debug("Facebook has not been initialized on this page.")})}},CBC.APP.ANA.VALIDATORS.FBPIXEL.validateFacebookLibrary(),window.CBC=window.CBC||{},(CBC=window.CBC).APP=CBC.APP||{},CBC.APP.ANA=CBC.APP.ANA||{},CBC.APP.ANA.VALIDATORS=CBC.APP.ANA.VALIDATORS||{},CBC.APP.ANA.VALIDATORS.MirRoar=function(){function n(e,t,i){return CBC.APP.SC.masterSwitch.switches.MirRoar?"function"==typeof i?CBC.APP.ANA.FORMATTERS.MirRoar.formatSignal(e,t,i):CBC.APP.ANA.FORMATTERS.MirRoar.formatSignal(e,t):void 0}return{trackEvent:function(e,t,i){null==CBC.APP.SC.masterSwitch.switches.MirRoar?CBC.APP.SC.UTIL.masterSwitchMetaPromise().then(function(){n(e,t,i)}):n(e,t,i)}}}(),window.CBC=window.CBC||{},(CBC=window.CBC).APP=CBC.APP||{},CBC.APP.ANA=CBC.APP.ANA||{},CBC.APP.ANA.DISPATCHERS=CBC.APP.ANA.DISPATCHERS||{},CBC.APP.ANA.DISPATCHERS.FBPIXEL={pageView:function(){window.fbq&&CBC.APP.ANA.VALIDATORS.FBPIXEL&&!CBC.APP.ANA.VALIDATORS.FBPIXEL.restrictKidsURL()&&fbq("track","PageView")}},window.CBC=window.CBC||{},(CBC=window.CBC).APP=CBC.APP||{},CBC.APP.ANA=CBC.APP.ANA||{},CBC.APP.ANA.DISPATCHERS=CBC.APP.ANA.DISPATCHERS||{},CBC.APP.ANA.DISPATCHERS.MirRoar={dispatch:function(){}},function(){var e={FATAL:"fatal",ERROR:"error",WARN:"warn",INFO:"info",DEBUG:"debug",TRACE:"trace"},a={OFF:"OFF",FATAL:e.FATAL,ERROR:e.ERROR,WARN:e.WARN,INFO:e.INFO,DEBUG:e.DEBUG,TRACE:e.TRACE,ALL:"ALL"},o=[e.FATAL,e.ERROR,e.WARN,e.INFO,e.DEBUG,e.TRACE],i=function(){function r(e){_classCallCheck(this,r);var t=0;t=(e=e||a.OFF)===a.OFF?0:e===a.ALL?o.length:o.indexOf(e)+1;for(var i=0;i<o.length;i++){var n=o[i];this[n]=i<t?this._log.bind(this,n):function(){}}}return _createClass(r,[{key:"_log",value:function(e,t){var i=this;e=e||"";var n=t;if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);n=t.replace(/{(\d+)}/g,function(e,t){return t in r?i._stringify(r[t]):e})}else n=this._stringify(t);console.log("DMP: ".concat(e.toUpperCase(),": ").concat(n))}},{key:"_stringify",value:function(e){var t=this;return e&&e.toString===Object.prototype.toString?JSON.stringify(e):Array.isArray(e)?"[".concat(e.map(function(e){return t._stringify(e)}).join(","),"]"):""+e}}]),r}();i.LEVEL=a,i.CHANNEL=e;function u(e,t){_classCallCheck(this,u),this.type=e,this.value=t}var s={watch:!0,live:!0,betalisten:!0,gem:!0},c={artists:!0},d=function(){function n(e){var i=this;_classCallCheck(this,n),this.hostname="",this.pathname="",this.path=[],this.query="",this.params={},this.fragment="",this.productHostName=null,e=(e=e||"").toLowerCase();var t=document.createElement("a");t.href=e,t.hostname&&(this.hostname=t.hostname.replace(/^www\./,"")),t.pathname&&(this.pathname=t.pathname,this.path=t.pathname.split("/").filter(Boolean)),t.hash&&(this.fragment=t.hash.replace(/^#/,"")),t.search&&(this.query=t.search.substr(1),this.query.split("&").forEach(function(e){var t=e.split("=");i.params[t[0]]=decodeURIComponent(t[1])}))}return _createClass(n,[{key:"getProductHostName",value:function(){if(null!=this.productHostName)return this.productHostName;this.productHostName=this.hostname||"";var e=this.hostname.split("."),t=null,i=null,n=null;if(2<=e.length&&(t=e[e.length-1],i=e[e.length-2],3<=e.length&&(n=e[0])),"ca"!==t)return this.productHostName;var r=null;if("cbc"===i)r=s;else{if("cbcmusic"!==i)return this.productHostName;r=c}return this.productHostName=r[n]?"".concat(n,".").concat(i,".").concat(t):"".concat(i,".").concat(t),this.productHostName}}],[{key:"getLocationUrl",value:function(){return window.location.href}}]),n}();u.TYPES={INTEREST:"int",GENERIC_PROPERTY:"genp",CUSTOM_SEGMENT:"seg",ACTION:"act",MEDIA:"med",GENERIC_GEO:"geo",GENERIC_DEMO:"dem",SITEMAPS:"sm",PAGE_VIEW:"pv"};var r=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"spa",get:function(){return!0===(window.CBC.APP.SC.DTM.DATA&&window.CBC.APP.SC.DTM.DATA.spa)}},{key:"keywords",get:function(){var e=window.CBC.APP.SC.DTM.DATA&&window.CBC.APP.SC.DTM.DATA.keywords;return void 0===e?null:e}},{key:"contentType",get:function(){return window.CBC.APP.SC.DTM.DATA&&window.CBC.APP.SC.DTM.DATA.contenttype||""}},{key:"url",get:function(){var e=window.CBC.APP.SC.DTM.formatted&&window.CBC.APP.SC.DTM.formatted.lotame&&window.CBC.APP.SC.DTM.formatted.lotame.url;return(e=e||d.getLocationUrl())||""}},{key:"userTier",get:function(){return window.CBC.APP.SC.DTM.DATA&&window.CBC.APP.SC.DTM.DATA.userTier||""}}]),e}(),n=function(){function n(e,t){var i=e.logger;_classCallCheck(this,n),this.logger=i,this._hostname=t||"",this._tagFiredCount=0,this._pageViewCount=0,this._queuedBehaviours=[]}return _createClass(n,[{key:"getClientId",value:function(){var e=10205;return"cbcmusic.ca"===this._hostname.replace(/.+?(?=cbc)/,"")&&(e=10907),e}},{key:"isInitialized",value:function(){return!!this.LOTCC}},{key:"init",value:function(){this.isInitialized()||this.loadScript()}},{key:"loadScript",value:function(){var e=this,t=this.getClientId(),i=this.createScriptElement();i.src="//tags.crwdcntrl.net/c/".concat(t,"/cc.js?ns=_cc").concat(t),i.async=!0;function n(){e.pageChange(),e.flushBehaviours()}i.readyState?i.onreadystatechange=function(){"loaded"!==i.readyState&&"complete"!==i.readyState||(i.onreadystatechange=null,n())}:i.onload=n,this.injectScriptElement(i)}},{key:"injectScriptElement",value:function(e){if(e){var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}}},{key:"createScriptElement",value:function(){return document.createElement("script")}},{key:"pageChange",value:function(){if(this.isInitialized()){this.logger.debug("Firing bcp() and removing iframes. tagFiredCount - {0}",this._tagFiredCount);for(var e=document.getElementsByTagName("iframe"),t=0;t<e.length;t++)/^LOTCCFrame/.test(e[t].id)&&(this.logger.debug("Removing iframe with id: {0}",e[t].id),e[t].remove(),t--);this.LOTCC.bcp(),this._tagFiredCount+=1}}},{key:"sendBehaviours",value:function(e,t){t&&(0<this.pageViewCount&&e.push(new u(u.TYPES.PAGE_VIEW,"y")),this._pageViewCount++),this.isInitialized()?this._sendBehaviours(e):this._queuedBehaviours.push({behaviours:e})}},{key:"_sendBehaviours",value:function(e){var t=e.reduce(function(e,t){return e.push(t.type),e.push(t.value),e},[]);0!==t.length&&this.LOTCC.bcpw.apply(void 0,t)}},{key:"flushBehaviours",value:function(){var i=this;this.isInitialized()&&this._queuedBehaviours.length&&(this._queuedBehaviours.forEach(function(t){try{i._sendBehaviours(t.behaviours)}catch(e){i.logger.error("Failed to send queued behaviours {0}",t.behaviours)}}),this._queuedBehaviours=[])}},{key:"pageViewCount",get:function(){return this._pageViewCount}},{key:"tagFiredCount",get:function(){return this._tagFiredCount}},{key:"LOTCC",get:function(){return window.LOTCC}},{key:"behaviours",get:function(){return this._queuedBehaviours.slice()}}]),n}(),l=function(){function i(e){var t=e.logger;_classCallCheck(this,i),this.logger=t}return _createClass(i,[{key:"listSubPaths",value:function(e,t){var i=1<arguments.length&&void 0!==t?t:" : ",n=[],r=e.path.slice(0);if(-1!==e.fragment.indexOf("/")){var a=e.fragment.split("/").filter(Boolean);0<a.length&&(r=[].concat(_toConsumableArray(r),["#"],_toConsumableArray(a)))}var o=[];return r.forEach(function(e){o.push(e),"#"!==e&&n.push(o.join(i))}),n}},{key:"buildPageChangeBehaviours",value:function(e,t,i){var n=this.buildSiteTrafficBehaviours(e),r=this.buildSiteSectionBehaviours(e,t),a=[];"story"===t&&(a=this.buildKeywordBehaviours(i));var o=this.buildTimestampBehaviours("Page View"),s=new d(d.getLocationUrl()),c=this.buildCampaignReferralBehaviours(s),u=[];return t&&"index"===t&&(u=this.buildLandingPageBehaviours(e)),[].concat(n,r,a,o,c,u)}},{key:"buildSiteTrafficBehaviours",value:function(e){var t=e?e.getProductHostName():"";return[new u(u.TYPES.INTEREST,"".concat(t," : Total Site Traffic"))]}},{key:"buildSiteSectionBehaviours",value:function(e,t){var i=[],n=e?e.getProductHostName():"",r="".concat(n," : Site Section");if(0===e.path.length)i.push(new u(u.TYPES.INTEREST,"".concat(r," : homepage")));else for(var a=this.listSubPaths(e),o=0;o<a.length;o++){var s=u.TYPES.INTEREST;o===a.length-1&&t&&"index"!==t&&(s=u.TYPES.MEDIA),i.push(new u(s,"".concat(r," : ").concat(a[o])))}return i}},{key:"buildLandingPageBehaviours",value:function(e){var t=[],i=e?e.getProductHostName():"",n="".concat(i," : Landing Page");if(0<e.path.length){var r=this.listSubPaths(e);t.push(new u(u.TYPES.MEDIA,"".concat(n," : ").concat(r[r.length-1])))}return t}},{key:"buildSubjectKeywordBehaviours",value:function(e){var t=[],i=u.TYPES.GENERIC_PROPERTY;if("entities"in e&&e.entities instanceof Array)for(var n=0;n<e.entities.length;n++){var r="Keyword : Subject";if(e.entities[n].name)for(var a=e.entities[n].name.split("/").filter(Boolean),o=0;o<a.length;o++)r+=" : "+a[o],-1===t.indexOf(r)&&t.push(r)}return t.map(function(e){return new u(i,e)})}},{key:"buildKeywordBehaviours",value:function(e){var t=[],i=u.TYPES.GENERIC_PROPERTY;if(e instanceof Array)for(var n=0;n<e.length;n++){var r=e[n].name,a="Keyword : "+r;if("Subject"===r){var o=this.buildSubjectKeywordBehaviours(e[n]);t=t.concat(o)}else if("entities"in e[n]&&e[n].entities instanceof Array)for(var s=0;s<e[n].entities.length;s++){var c=a+" : "+e[n].entities[s].name;t.push(new u(i,c))}}return t}},{key:"buildShareBehaviours",value:function(e,t){t=t||"";var i=e?e.getProductHostName():"";t=t.toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()});var n="".concat(i," : Share Content"),r="".concat(i," : Share Content on ").concat(t),a=this.listSubPaths(e);a.push("");var o=[];return a.forEach(function(e){e=e&&" : ".concat(e),o.push(new u(u.TYPES.ACTION,"".concat(n).concat(e)),new u(u.TYPES.ACTION,"".concat(r).concat(e)))}),o}},{key:"buildSurveySubmissionBehaviours",value:function(i,e){if(!e||!(e instanceof Array)||e.length<=0)return this.logger.error("Answers does not exist or empty"),[];var n=[];return e.forEach(function(e){var t="Survey Data : ".concat(i," : ").concat(e.tag," : ");e.choices instanceof Array!=!1&&e.choices.forEach(function(e){n.push(new u(u.TYPES.ACTION,"".concat(t).concat(e)))})}),n}},{key:"buildSurveyLoadedBehaviour",value:function(e){return e?[new u(u.TYPES.ACTION,"Survey Loaded : ".concat(e))]:[]}},{key:"buildAudienceSegmentRatingBehaviours",value:function(e,t,i){if("number"!=typeof i)return this.logger.error("Segment rating was not provided"),[];var n=0<i?"like":"dislike",r="Audience Segment Feedback : ".concat(e," : ").concat(n),a=[new u(u.TYPES.INTEREST,r)];if(t){var o="Family Feedback : ".concat(t," : ").concat(n);a.push(new u(u.TYPES.INTEREST,o))}return a}},{key:"buildTimestampBehaviours",value:function(e){var t=new Date,i="Timestamp",n={0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"}[t.getDay()],r=t.getHours(),a=r<10?"0".concat(r,":00"):"".concat(r,":00");return[new u(u.TYPES.ACTION,"".concat(i," : ").concat(a," : ").concat(e)),new u(u.TYPES.ACTION,"".concat(i," : ").concat(n," : ").concat(e)),new u(u.TYPES.ACTION,"".concat(i," : ").concat(a," : ").concat(n," : ").concat(e))]}},{key:"buildCampaignReferralBehaviours",value:function(e){return e.params&&void 0!==e.params.cmp&&null!==e.params.cmp?[new u(u.TYPES.INTEREST,"Referral : Campaign : ".concat(e.params.cmp))]:[]}},{key:"buildRegionChangeBehaviours",value:function(e){return e?[new u(u.TYPES.GENERIC_GEO,"Local Region : news : ".concat(e))]:[]}},{key:"buildAdTargetingOptOutBehaviour",value:function(e){return e?[new u(u.TYPES.ACTION,"Global Ad Targeting Opt Out : ".concat(e))]:[]}},{key:"buildStartWebSessionBehaviour",value:function(){return[new u(u.TYPES.ACTION,"Start Web Session")]}},{key:"buildReadBehaviours",value:function(e,t){var i=[],n=e?e.getProductHostName():"";if("comments"===t)i.push(new u(u.TYPES.ACTION,"".concat(n," : Read comment")));else for(var r="".concat(n," : Read"),a=this.listSubPaths(e),o=0;o<a.length;o++){var s=u.TYPES.INTEREST;o===a.length-1&&t&&"index"!==t&&(s=u.TYPES.MEDIA),i.push(new u(s,"".concat(r," : ").concat(a[o])))}return i}},{key:"buildStreamedShortFormVideo",value:function(e){if(!e.content||!e.content.media)return[];var t=["cbc.ca","streamed"].concat(_toConsumableArray([e.content.media.genre,e.content.media.region,e.content.media.show,e.content.title].filter(function(e){return!!e}))).join(" : ");return[new u(u.TYPES.MEDIA,t)]}}]),i}(),C=function(){function i(e){var t=e.logger;_classCallCheck(this,i),this.logger=t}return _createClass(i,[{key:"isValidString",value:function(e){return"string"==typeof e&&0<e.trim().length&&"nan"!==e.toLowerCase()&&"null"!==e.toLowerCase()&&"undefined"!==e.toLowerCase()}},{key:"buildStreamedBehaviours",value:function(e,t){var i=[],n=e?e.getProductHostName():"",r="".concat(n," : streamed");if(t){if(i.push(new u(u.TYPES.ACTION,r)),t.content&&t.content.media)if(t.content.media.liveondemand&&"live"===t.content.media.liveondemand||"linear"===t.content.media.liveondemand)t.content.media.streamtitle&&i.push(new u(u.TYPES.INTEREST,"".concat(r," : ").concat(t.content.media.liveondemand," : ").concat(t.content.media.streamtitle)));else if(this.isValidString(t.content.media.show)){var a="".concat(r," : ").concat(t.content.media.show);if(i.push(new u(u.TYPES.INTEREST,a)),this.isValidString(t.content.media.seasonnumber)){var o="".concat(a," : season ").concat(t.content.media.seasonnumber);this.isValidString(t.content.media.episodenumber)?o="".concat(o," : episode ").concat(t.content.media.episodenumber):this.isValidString(t.content.media.streamtitle)&&(o="".concat(o," : ").concat(t.content.media.streamtitle)),i.push(new u(u.TYPES.MEDIA,o))}else this.isValidString(t.content.media.episodenumber)?i.push(new u(u.TYPES.MEDIA,"".concat(a," : episode ").concat(t.content.media.episodenumber))):this.isValidString(t.content.media.streamtitle)&&i.push(new u(u.TYPES.MEDIA,"".concat(a," : ").concat(t.content.media.streamtitle)))}t.feature&&this.isValidString(t.feature.name)&&i.push(new u(u.TYPES.ACTION,"".concat(r," : ").concat(t.feature.name)))}return i}},{key:"buildSubscribedBehaviours",value:function(e){var t=[],i=e?e.getProductHostName():"",n="".concat(i," : subscribed");return t.push(new u(u.TYPES.ACTION,n)),t}},{key:"buildUnsubscribedBehaviours",value:function(e){var t=[],i=e?e.getProductHostName():"",n="".concat(i," : unsubscribed");return t.push(new u(u.TYPES.ACTION,n)),t}},{key:"buildLoadedBehaviours",value:function(e,t){var i=[],n=e?e.getProductHostName():"",r="".concat(n," : loaded");return t&&i.push(new u(u.TYPES.ACTION,"".concat(r," : user tier : ").concat(t))),i}}]),i}(),p=function(){function t(e){_classCallCheck(this,t),this.dmp=e,this.logger=e.logger,this.pubSub=e.pubSub,this.lotame=e.lotame,this.behaviourBuilder=e.behaviourBuilder,this.behaviourBuilderOtt=e.behaviourBuilderOtt}return _createClass(t,[{key:"init",value:function(){this._pageChangeSub=this._onPageChange.bind(this),this.pubSub.subscribe("pageChange",this._pageChangeSub),this._sendSurveyDataSub=this._onSendSurveyData.bind(this),this.pubSub.subscribe("surveySubmission",this._sendSurveyDataSub),this._sendSurveyNameSub=this._onSendSurveyName.bind(this),this.pubSub.subscribe("surveyLoad",this._sendSurveyNameSub),this._storySharedSub=this._onStoryShared.bind(this),this.pubSub.subscribe("SHARED",this._storySharedSub),this._rateSegmentSub=this._onRateSegment.bind(this),this.pubSub.subscribe("rateAudienceSegment",this._rateSegmentSub),this._regionChangeSub=this._onRegionChange.bind(this),this.pubSub.subscribe("regionChange",this._regionChangeSub),this._adTargetingOptOutSub=this._onAdTargetingOptOut.bind(this),this.pubSub.subscribe("adTargetingOptOut",this._adTargetingOptOutSub),this._startWebSessionSub=this._onStartWebSession.bind(this),this.pubSub.subscribe("START WEB SESSION",this._startWebSessionSub),this._videoStreamedSub=this._onVideoStreamed.bind(this),this.pubSub.subscribe("STREAMED",this._videoStreamedSub),this._subscribedEventSub=this._onSubscribedEvent.bind(this),this.pubSub.subscribe("SUBSCRIBED",this._subscribedEventSub),this._unsubscribedEventSub=this._onUnsubscribedEvent.bind(this),this.pubSub.subscribe("UNSUBSCRIBED",this._unsubscribedEventSub),this._loadedEventSub=this._onLoadedEvent.bind(this),this.pubSub.subscribe("LOADED",this._loadedEventSub),this._readEventSub=this._onReadEvent.bind(this),this.pubSub.subscribe("READ",this._readEventSub)}},{key:"_onPageChange",value:function(){this.logger.debug("pageChange subscriber");var e=r.url;if(e){var t=this.behaviourBuilder.buildPageChangeBehaviours(new d(e),r.contentType,r.keywords);this.lotame.sendBehaviours(t,!0)}}},{key:"_onStoryShared",value:function(e,t){this.logger.debug("Story shared - {0}",t);var i=new d(r.url),n=this.behaviourBuilder.buildShareBehaviours(i,t.network);this.lotame.sendBehaviours(n)}},{key:"_onSendSurveyData",value:function(e,t){this.logger.debug("Send survey data sub - {0}",t);var i=this.behaviourBuilder.buildSurveySubmissionBehaviours(t.name,t.answers);this.lotame.sendBehaviours(i)}},{key:"_onSendSurveyName",value:function(e,t){this.logger.debug("Send survey name sub - {0}",t);var i=this.behaviourBuilder.buildSurveyLoadedBehaviour(t);this.lotame.sendBehaviours(i)}},{key:"_onRateSegment",value:function(e,t){var i=t.segmentId,n=t.family,r=t.rating,a=this.behaviourBuilder.buildAudienceSegmentRatingBehaviours(i,n,r);this.lotame.sendBehaviours(a)}},{key:"_onRegionChange",value:function(e,t){var i=this.behaviourBuilder.buildRegionChangeBehaviours(t.title);this.lotame.sendBehaviours(i)}},{key:"_onAdTargetingOptOut",value:function(e,t){var i=this.behaviourBuilder.buildAdTargetingOptOutBehaviour(t);this.lotame.sendBehaviours(i)}},{key:"_onStartWebSession",value:function(){var e=this.behaviourBuilder.buildStartWebSessionBehaviour();this.lotame.sendBehaviours(e)}},{key:"_onReadEvent",value:function(){var e=CBC.APP.SC.DTM.formatted.googlecloud.content&&CBC.APP.SC.DTM.formatted.googlecloud.content.type;e=e||r.contentType;var t=new d(r.url),i=this.behaviourBuilder.buildReadBehaviours(t,e);this.lotame.sendBehaviours(i)}},{key:"_onVideoStreamed",value:function(e,t){var i=new d(r.url),n=this.behaviourBuilderOtt.buildStreamedBehaviours(i,t);i.pathname.match(/^\/player\/play\/\d+/)&&(n=n.concat(this.behaviourBuilder.buildStreamedShortFormVideo(t))),this.lotame.sendBehaviours(n)}},{key:"_onSubscribedEvent",value:function(){var e=new d(r.url),t=this.behaviourBuilderOtt.buildSubscribedBehaviours(e);this.lotame.sendBehaviours(t)}},{key:"_onUnsubscribedEvent",value:function(){var e=new d(r.url),t=this.behaviourBuilderOtt.buildUnsubscribedBehaviours(e);this.lotame.sendBehaviours(t)}},{key:"_onLoadedEvent",value:function(){var e=new d(r.url),t=this.behaviourBuilderOtt.buildLoadedBehaviours(e,r.userTier);this.lotame.sendBehaviours(t)}}]),t}(),h=function(){function i(e){var t=e.logger;_classCallCheck(this,i),this.logger=t}return _createClass(i,[{key:"isLoggedIn",value:function(){try{var e=this.viafouraApi.users.current().user_privilege;return e&&"guest"!==e}catch(e){return!1}}},{key:"version",get:function(){return window.vf?2:window.viafoura?1:0}},{key:"viafouraApi",get:function(){return window.viafoura}},{key:"userId",get:function(){return this.isLoggedIn()?this.viafouraApi.users.current().id:(this.logger.debug("user unauthenticated!"),null)}},{key:"userPrivilege",get:function(){return this.isLoggedIn()&&this.viafouraApi.users.current().user_privilege?this.viafouraApi.users.current().user_privilege:(this.logger.debug("user has no privilege!"),null)}},{key:"userDateCreated",get:function(){var e=this.isLoggedIn()?this.viafouraApi.users.current().date_created:0;return 1<this.version&&(e/=1e3),e}},{key:"commentsMade",get:function(){return this.isLoggedIn()?this.viafouraApi.users.current().comments_made:0}},{key:"activityRange",get:function(){var e=(Date.now()/1e3-this.userDateCreated+1)/86400,t=this.commentsMade/e;return t<=0?"inactive":t<=1?"less than 1 comment per day":t<=5?"1-5 comments per day":t<=16?"5-16 comments per day":"more than 16 comments per day"}}]),i}(),g=function(){function a(e){var t=e.pubSub,i=e.logger,n=e.lotame,r=e.util;_classCallCheck(this,a),this.logger=i,this.lotame=n,this.pubSub=t,this.util=r}return _createClass(a,[{key:"init",value:function(){this._pageChangeSub=this.update.bind(this),this.pubSub.subscribe("pageChange",this._pageChangeSub)}},{key:"update",value:function(){-1==="//www.cbc.ca/cookie-jar/api/geoinfo/list".indexOf("www.cbc.ca")&&(900<=this.getSecondsDiff()?(this.updateSessionTime(),this.callGeoJson()):this.logger.debug("Skipping EdgescapeSession update"))}},{key:"callGeoJson",value:function(){var t=this,e="//www.cbc.ca/cookie-jar/api/geoinfo/list";this.util.makeGETRequest(e,{success:function(e){t.logger.debug("xhr.responseText: {0}",e.responseText),t.sendData(e.responseText)},failure:function(){t.logger.error("Unable to talk to config URL: {0}",e)}})}},{key:"sendData",value:function(e){this.logger.trace("geo responseText: {0}",e);var t=JSON.parse(e),i=this.getGeoDataArr(t);this.lotame.sendBehaviours(i)}},{key:"getHumanReadableName",value:function(e){return e.match(/([A-Z])?[a-z]+/g).join(" ").toLowerCase()}},{key:"getGeoDataArr",value:function(e){var t=[];for(var i in e)if(e.hasOwnProperty(i)){var n=this.getHumanReadableName(i)+" : "+e[i];t.push(new u(u.TYPES.GENERIC_GEO,n))}return this.logger.trace("geo dataArr: {0}",t),t}},{key:"updateSessionTime",value:function(){var e={value:!0,timestamp:(new Date).getTime()};try{window.sessionStorage.setItem("edgescape",JSON.stringify(e))}catch(e){void 0===window.sessionStorage?this.logger.debug("This browser doesn't support sessionStorage. The error message is {0}",e):this.logger.debug("Unable to store edgescape in sessionStorage: {0}",e)}}},{key:"getSessionTime",value:function(){try{return JSON.parse(window.sessionStorage.getItem("edgescape")).timestamp}catch(e){return void 0===window.sessionStorage?this.logger.debug("This browser doesn't support sessionStorage. The error message is {0}",e):this.logger.debug("No value for key 'edgescape' in sessionStorage or 'timestamp' in edgescape."),0}}},{key:"getSecondsDiff",value:function(){var e=(new Date).getTime(),t=Math.floor((e-this.getSessionTime())/1e3);return this.logger.trace("Time difference: {0}",t),t}}]),a}(),P=function(){function r(e){var t=e.viafoura,i=e.pubSub,n=e.logger;_classCallCheck(this,r),this.vf=t,this.pubSub=i,this.logger=n,this.vfIdToLotame="vfidtolotame",this.lotamePixel=null,this.lotameScr="//bcp.crwdcntrl.net/map/c=10743/tp=VIAF/tpid="}return _createClass(r,[{key:"init",value:function(){var i=this;void 0===this.vf.viafouraApi?this.pubSub.subscribe("viafouraAvailable",function(e,t){i.addVfEvents()}):this.addVfEvents()}},{key:"run",value:function(){this.logger.debug("Running Viafoura/Lotame sync pixel code."),this.lotamePixel=this.getPixel(this.vfIdToLotame),this.vf.isLoggedIn()?this.lotamePixel?this.updatePixel():this.addPixel():this.lotamePixel&&this.deletePixel()}},{key:"addVfEvents",value:function(){var e=this;this.logger.debug("Add Viafoura events");try{this.vf.viafouraApi.subscribe("onLoginSuccess",function(){e.run()})}catch(e){this.logger.error("Can't subscribe onLoginSuccess event.")}try{this.vf.viafouraApi.subscribe("onLogoutSuccess",function(){e.run()})}catch(e){this.logger.error("Can't subscribe onLogoutSuccess event.")}}},{key:"getPixel",value:function(e){return document.getElementById(e)}},{key:"addPixel",value:function(){this.logger.debug("Add Viafoura/Lotame sync pixel code.");var e=document.createElement("img");e.src=this.lotameScr+this.vf.userId,e.id=this.vfIdToLotame,e.async=!0,document.body.appendChild(e)}},{key:"updatePixel",value:function(){this.logger.debug("Update Viafoura/Lotame sync pixel code.");var e=this.getPixel(this.vfIdToLotame),t=this.lotameScr+this.vf.userId;e.src=t}},{key:"deletePixel",value:function(){this.logger.debug("Delete Viafoura/Lotame sync pixel code."),this.getPixel(this.vfIdToLotame).remove()}}]),r}(),b=function(){function o(e){var t=e.logger,i=e.viafoura,n=e.lotame,r=e.pubSub,a=e.util;_classCallCheck(this,o),this.logger=t,this.viafoura=i,this.lotame=n,this.pubSub=r,this.util=a}return _createClass(o,[{key:"init",value:function(){this._viafouraAvailableSub=this._onViafouraAvailable.bind(this),void 0===this.viafoura.viafouraApi?this.pubSub.subscribe("viafouraAvailable",this._viafouraAvailableSub):this._viafouraAvailableSub(),this._signInSub=this._onSignIn.bind(this),this.pubSub.subscribe("SIGNED IN",this._signInSub),this._signOutSub=this._onSignOut.bind(this),this.pubSub.subscribe("SIGNED OUT",this._signOutSub)}},{key:"callLoginRadiusApi",value:function(e){var t=this,i="//api.loginradius.com/api/v2/userprofile?access_token="+e;this.util.makeGETRequest(i,{success:function(e){t.logger.debug("User logged in success : {0}",e.responseText),t.sendData(JSON.parse(e.responseText))},failure:function(){t.logger.error("Error : login radius api call to get user profile")}})}},{key:"sendData",value:function(e){var t;if(e){var i=e.Addresses&&e.Addresses[0]&&e.Addresses[0].PostalCode?e.Addresses[0].PostalCode.substring(0,3):"",n=e.Gender?e.Gender:"",r=e.Age?e.Age:"";t=[new u(u.TYPES.GENERIC_DEMO,"User Info : Gender : "+n),new u(u.TYPES.GENERIC_DEMO,"User Info : Age : "+r),new u(u.TYPES.GENERIC_GEO,"User Info : Postal Code : "+i)],this.lotame.sendBehaviours(t)}}},{key:"_onSignIn",value:function(){var e=this.accessTokenForUser;this.loginRadiusV2&&e&&this.callLoginRadiusApi(e)}},{key:"_onSignOut",value:function(){this.lotame.sendBehaviours([new u(u.TYPES.ACTION,"User Info : Sign out")])}},{key:"_onViafouraAvailable",value:function(){var e;e=Boolean(this.viafoura.userId)?[new u(u.TYPES.CUSTOM_SEGMENT,"Authenticated User"),new u(u.TYPES.CUSTOM_SEGMENT,"User privilege: "+this.viafoura.userPrivilege),new u(u.TYPES.CUSTOM_SEGMENT,"User activity range: "+this.viafoura.activityRange)]:[new u(u.TYPES.CUSTOM_SEGMENT,"Unauthenticated User")],this.lotame.sendBehaviours(e)}},{key:"loginRadiusV2",get:function(){return this.viafoura&&this.viafoura.viafouraApi&&this.viafoura.viafouraApi.core&&this.viafoura.viafouraApi.core.loginRadiusSVOD&&this.viafoura.viafouraApi.core.loginRadiusSVOD.LRV2?this.viafoura.viafouraApi.core.loginRadiusSVOD.LRV2:window.LoginRadiusV2?window.LoginRadiusV2:void 0}},{key:"accessTokenForUser",get:function(){return window.localStorage.getItem("LRTokenKey")?window.localStorage.getItem("LRTokenKey").replace(/"/g,""):window.localStorage.getItem("lrtoken")?window.localStorage.getItem("lrtoken").replace(/"/g,""):null}}]),o}(),t=function(){function t(e){_classCallCheck(this,t),this.pubSub=e.pubSub,this.util=e.util,this.logger=new i(e.logLevel),this.lotame=new n(this,e.hostname),this.behaviourBuilder=new l(this),this.behaviourBuilderOtt=new C(this),this.subscribers=new p(this),this.viafoura=new h(this),this.syncPixel=new P(this),this.edgescapeSession=new g(this),this.userInfo=new b(this),this._modules=[this.lotame,this.subscribers,this.syncPixel,this.edgescapeSession,this.userInfo]}return _createClass(t,[{key:"init",value:function(){/\/(kidsnews|kidscbc2|kidsfantasyhockey)(\/|$)/.test(r.url.toLowerCase())?this.logger.debug("Not initializing DMP on CBC Kids or Kids News"):this._modules.forEach(function(e){e.init()})}}]),t}();[window.Element.prototype,window.CharacterData.prototype,window.DocumentType.prototype].forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})});var f=new t({logLevel:window.CBC.APP.SC.DEBUG?i.LEVEL.DEBUG:i.LEVEL.ERROR,hostname:window.location.hostname,pubSub:window.CBC.APP.PubSub,util:window.CBC.APP.SC.UTIL});f.logger.debug("DMP initialize starting"),f.init(),function(){window.CBC=window.CBC||{};var e=window.CBC;e.APP=e.APP||{},e.APP.DMP=e.APP.DMP||{},e.APP.DMP.pageChange=function(){f.logger.debug("Forced DMP pageChange"),r.spa&&e.APP.PubSub.publish("pageChange")}}()}(),window.CBC||(window.CBC={}),CBC.APP||(CBC.APP={}),CBC.APP.PubSub=CBC.APP.PubSub||{},CBC.APP.SC||(CBC.APP.SC={}),CBC.APP.SC.Subscribers=CBC.APP.SC.Subscribers||{},CBC.APP.SC.Subscribers.pageview=CBC.APP.SC.Subscribers.pageview||[],CBC.APP.SC.Pillar=CBC.APP.SC.Pillar||{},CBC.APP.SC.PageTracker=function(){var u=CBC.APP.SC.UTIL,d=null,l=[],C=!1;l.pageviewcount=0;var p=!1;function t(){l.channel="misc",l.subsection=[],l.pageurl="",l.searchprefix="",l.separator=":",l.index="index",l.contenttype="page",l.pagetype="",l.pagetitle="",l.scqs={},l.directory="",l.pageName=null,l.hier1=null}return t(),{init:function(){try{CBC.APP.PubSub.turnOn()}catch(e){console.log("There has been an error: "+e)}var e=document.location.href;if(-1<e.indexOf("polopoly")||-1<e.indexOf("/meta/preview")||-1<e.indexOf("/preview/www")||-1<e.indexOf("/preview/web"))return u.console("Preview page. Page Tracking Disabled."),!1;if(-1!==window.Detectizr.ua.indexOf("googlebot"))return!1;if(u.inDebugMode(),!s_cbc_sitecatalyst)return u.console("The Adobe s_code.js is missing on the page"),!1;d=s_cbc_sitecatalyst,p?(this.clearVariables(),window.CBC.APP.SC.Subscribers.pageview.push({cb:function(){window.dispatchEvent(new window.CustomEvent("ConductricsStateChange",{detail:d.pageName}))}})):document.addEventListener("click",CBC.APP.SC.LinkTracker.checkClickEvent);var t=CBC.APP.versions["cbc-stats-top"],i=CBC.APP.versions["cbc-stats-bottom"];if(void 0!==t&&void 0!==i&&this.checkStatsVersions(t,i),d.prop36=(window.self!==window.top).toString(),void 0===CBC.APP.SC.DTM&&(CBC.APP.SC.DTM={}),void 0===CBC.APP.SC.DTM.DATA&&(CBC.APP.SC.DTM.DATA={}),0<Object.keys(CBC.APP.SC.DTM.DATA).length?(CBC.APP.SC.DTM.DATA.authenticated=this.isLoggedIn(),u.setFormattedLayer(),l.scqs=JSON.parse(JSON.stringify(CBC.APP.SC.DTM.formatted.adobe)),l.scqs.storytitle&&(l.scqs.title=l.scqs.storytitle,CBC.APP.SC.storyTitle=l.scqs.storytitle.toLowerCase().replace(/\s/g,"-")),l.pagetitle||(l.pagetitle=l.scqs.pagetitle?l.scqs.pagetitle:""),l.scqs.publishedTime&&(l.scqs.pubdate=l.scqs.publishedTime),d.prop75="new"):(u.console("Data Layer - Data layer not found. Defaulting to URL."),l.scqs=this.urlToObj(document.location.hostname,document.location.pathname),d.prop75="dne"),u.initReferringDepartmentStatus(),this.setTimeVars(),this.setOsAppVars(),this.setSearchPrefix(),this.getAdHierarchy(),this.setFromMetaTags(),CBC.APP.readJS.checkLoad(),this.getUrl(),CBC.APP.SC.DTM.DATA.spa&&0<l.pageviewcount?this.getReferrer(l.scqs.referrer.url):(this.getReferrer(document.referrer),window.conductricsDataLayer=window.conductricsDataLayer||[],CBC.APP.SC.DTM&&window.conductricsDataLayer.push(CBC.APP.SC.DTM)),l.scqs.referrer&&l.scqs.referrer.pillar?d.prop53=l.scqs.referrer.pillar:d.prop53="noReferrer",l.scqs.referrer&&l.scqs.referrer.department){var n=l.scqs.referrer.department;d.prop65=[n.level1,n.level2,n.level3].filter(function(e){return e}).join(":"),d.prop65="noreferrer"===d.prop65?"noReferrer":d.prop65}else d.prop65="noReferrer";CBC.APP.SC.DTM.DATA.wordcount&&(d.prop7=CBC.APP.SC.DTM.DATA.wordcount),this.setWordCount(),this.setStrategicPillar(),this.setCMFAppId(),this.readLinkTrackerCookie(),this.setUserJourney(),this.setUserTier(),this.setDateVars(),this.setSponsor(),this.setContentPartner(),this.detectAdBlocker(),this.checkCbcIdCookieExists(),this.checkHTTPSstatus(document.location.href);var r=this.checkFeatureNameAndPosition();this.checkEmbeddedMedia(),!C&&window.vf&&window.vf.$once&&(window.vf.$once("comments","read",function(e){window.vf.context.get("page").then(function(e){e.num_replies&&CBC.APP.SC.EventTracker.trackEvent("READ",{content:{type:"comments"}})}),C=!1}),C=!0),this.parseStatsVars(),CBC.APP.PubSub.publish("pageChange"),CBC.APP.COMSCORE&&CBC.APP.COMSCORE.Call(),CBC.APP.CXENSE&&CBC.APP.CXENSE.pageView(),window._sf_async_config.cbc&&"gamp"!==l.scqs.syndicate&&window._sf_async_config.cbc.pageChange(),CBC.APP.ANA.DISPATCHERS.FBPIXEL&&CBC.APP.ANA.DISPATCHERS.FBPIXEL.pageView();var a={},o="LOADED";r||!d.prop22&&!d.prop24||(a.feature={},d.prop22&&(a.feature.name=d.prop22),d.prop24&&(a.feature.position=d.prop24)),l.scqs.referrer&&l.scqs.referrer.url===l.scqs.url&&(o="LOADED MORE"),"LOADED"===o&&(a.custom={},a.custom.DNT=CBC.APP.SC.UTIL.getDoNotTrackValue(),a.custom.cookiesenabled=window.navigator.cookieEnabled),CBC.APP.SC.EventTracker.trackEvent(o,a),l.pageviewcount+=1,p||(p=!0,window.viafoura&&window.viafoura.users&&window.viafoura.users.current&&window.viafoura.users.current().id?u.setCBCPlusIDPromise().catch(function(e){CBC.APP.SC.UTIL.console(e)}):u.setCBCVisitorIDPromise().catch(function(e){CBC.APP.SC.UTIL.console(e)}));var s=0,c=window.setInterval(function(){if(d.pageName&&d.events||39<s){var e=CBC.APP.SC.Subscribers.pageview,t=e.length,i=0;for(i=0;i<t;++i)"function"==typeof e[t-i-1].cb?e.pop().cb():e.pop();window.clearInterval(c)}else++s},10);return!0},checkFeatureNameAndPosition:function(){return!!(CBC.APP.SC.DTM&&CBC.APP.SC.DTM.formatted&&CBC.APP.SC.DTM.formatted.adobe&&CBC.APP.SC.DTM.formatted.adobe.feature&&(CBC.APP.SC.DTM.formatted.adobe.feature.name||CBC.APP.SC.DTM.formatted.adobe.feature.position))&&(CBC.APP.SC.DTM.formatted.adobe.feature.name&&(d.prop22=CBC.APP.SC.DTM.formatted.adobe.feature.name,d.eVar83="D=c22"),CBC.APP.SC.DTM.formatted.adobe.feature.position&&(d.prop24=CBC.APP.SC.DTM.formatted.adobe.feature.position,d.eVar84="D=c24"),!0)},checkEmbeddedMedia:function(){CBC.APP.SC.DTM&&CBC.APP.SC.DTM.formatted&&CBC.APP.SC.DTM.formatted.adobe&&["story","segment","blogentry"].includes(CBC.APP.SC.DTM.DATA.contenttype)&&(d.prop16=CBC.APP.SC.DTM.formatted.adobe.embedtypes)},checkCbcIdCookieExists:function(){u.getCookie("CBC_ID")?(u.expireCookie("CBC_ID"),d.prop73="true"):d.prop73="false"},checkHTTPSstatus:function(e){return new RegExp(/^https:\/\//).test(e)?(d.prop74="yes",!0):!(d.prop74="no")},objToQueryString:function(e){var t,i="";for(t in e)e.hasOwnProperty(t)&&(i+="&"+t+"="+e[t]);return i.slice(1)},detectAdBlocker:function(){CBC.APP.SC.ads?(d.prop68="false",d.eVar68="false"):(d.prop68="true",d.eVar68="true")},urlToObj:function(e,t){var i,n=t.split("/"),r={},a=0;a=(e.match("cbcmusic")?r.contentarea="music":r.contentarea="misc",1);for(var o=0;o<n.length;o++)""!==n[o]&&(i="subsection"+a,a++,r[i]=u.sanitize(n[o]));return r.contenttype="index",r.url="https://"+e+t,r},getReferrer:function(e){return void 0!==e&&""!==e&&(d.prop57=e,d.eVar57="D=c57",!0)},setInitialized:function(){p=!0},setUserTier:function(){window.viafoura&&window.viafoura.users&&window.viafoura.users.current&&window.viafoura.users.current().user_privilege?this.isLoggedIn()?d.prop58="authenticated":d.prop58="unauthenticated":CBC&&CBC.APP&&CBC.APP.SC&&CBC.APP.SC.DTM&&CBC.APP.SC.DTM.DATA&&CBC.APP.SC.DTM.DATA.userTier&&(d.prop58=CBC.APP.SC.DTM.DATA.userTier)},readLinkTrackerCookie:function(){try{var e=window.s_cbc_sitecatalyst.c_r("SC_LINKS");if(e){var t=JSON.parse(e);return d.prop21=t.pageName,d.prop22=t.linkName,d.prop23=t.concatValue,d.prop24=t.linkPosition,window.s_cbc_sitecatalyst.c_w("SC_LINKS","",0),!0}return}catch(e){window.s_cbc_sitecatalyst.c_w("SC_LINKS","",0)}},parseStatsVars:function(){var e;for(l.scqs.contentarea?l.channel=l.scqs.contentarea:l.scqs.contentArea&&(l.channel=l.scqs.contentArea),d.channel=l.channel,l.subsection=[],l.scqs.contenttype&&(l.contenttype=l.scqs.contenttype),d.prop4=l.contenttype,e=1;e<=5;e++)l.scqs["subsection"+e]&&l.subsection.push(l.scqs["subsection"+e]);l.scqs.contentid&&(d.prop6=l.scqs.contentid),this.setContentVars(),d.pageName=this.setPageName(),d.hier1=l.hier1,this.setSubsectionVars(),d.prop14=this.removeDomain(l.pageurl),d.eVar14=l.pageurl,d.prop15=this.getUserSegmentation(),this.registerPageView()},setCMFAppId:function(){l.scqs.cmfAppId&&(d.prop69=l.scqs.cmfAppId)},setStrategicPillar:function(){0===Object.getOwnPropertyNames(CBC.APP.SC.Pillar).length&&(CBC.APP.SC.Pillar={pillar:{available:["feed","listen","watch","legacyee"],url:{default:"legacy","cbc.ca/listen":"listen","cbcmusic.ca":"listen","watch.cbc.ca":"watch","gem.cbc.ca":"watch","watch.qa.nm.cbc.ca":"watch","gem.qa.nm.cbc.ca":"watch"}}});var e=CBC.APP.SC.Pillar.pillar;if(d.prop67=e.url.default,l.scqs.pillar&&-1<e.available.indexOf(l.scqs.pillar))d.prop67=u.sanitize(l.scqs.pillar);else if(!CBC.APP.SC.QueryString&&!window.scstats&&CBC.APP.SC.DTM.DATA.pillar&&-1<e.available.indexOf(CBC.APP.SC.DTM.DATA.pillar))d.prop67=u.sanitize(CBC.APP.SC.DTM.DATA.pillar);else for(var t in e.url)if(e.url.hasOwnProperty(t)&&-1<l.pageurl.indexOf(t)){d.prop67=e.url[t],CBC.APP.SC.DTM.DATA.pillar=e.url[t],l.scqs.pillar=e.url[t];break}},setUserJourney:function(){var e=CBC.APP.SC.Pillar.pillar.url.default;void 0!==l.scqs.pillar&&l.scqs.pillar!==e?e=l.scqs.pillar:d.prop67!==e&&(e=d.prop67),void 0!==l.scqs.syndicate&&"cbcca-web"!==l.scqs.syndicate?e=l.scqs.syndicate:"cbcca-web"!==d.prop66&&(e=d.prop66),d.prop35=e+":"+l.scqs.contentarea+":"+l.scqs.contenttype},setTimeVars:function(){var e=this.getTimeVars();void 0!==e.var9&&(d.prop9=e.var9),void 0!==e.var10&&(d.prop10=e.var10)},getTimeVars:function(){function e(e){return"number"==typeof e?("0"+e).slice(-2):null}var t,i,n={},r=new Date,a=(t=r)&&"function"==typeof t.getTimezoneOffset?-t.getTimezoneOffset()/60:null,o=r.getDay(),s=0===o||6===o?"weekend":"weekday";return n.var9=((i=r)&&"function"==typeof i.getHours?e(i.getHours())+e(i.getMinutes()):null)+"|"+a,n.var10=s+"|"+["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][o]+"|"+("0"+r.getHours()).slice(-2)+(30<r.getMinutes()?"30":"00"),n},setOsAppVars:function(){var e=this.getOsAppVars();void 0!==e.var60&&(d.prop60=e.var60),void 0!==e.var61&&(d.prop61=e.var61),void 0!==e.var62&&(d.prop62=e.var62),void 0!==e.var63&&(d.prop63=e.var63),void 0!==e.var64&&(d.prop64=e.var64)},getAdHierarchy:function(){l.scqs.hierarchy?d.prop65=l.scqs.hierarchy:CBC.Metadata&&CBC.Metadata.hierarchy&&(d.prop65=CBC.Metadata.hierarchy)},getOsAppVars:function(){var e={};return CBC.APP.SC.DTM.formatted&&CBC.APP.SC.DTM.formatted.adobe&&CBC.APP.SC.DTM.formatted.adobe.appname?e.var60=CBC.APP.SC.DTM.formatted.adobe.appname:e.var60="cbcca-web",e.var61="osVersion",e.var62="os",e.var63="web",e.var64="2.60.0",e.var64=l.scqs.appVersion?l.scqs.appVersion:e.var64,void 0===window.Detectizr||void 0===window.Detectizr.os||("undefined"!==window.Detectizr.os.name&&("ott-web-app"===e.var60?e.var62=window.Detectizr.os.name+"|"+e.var60:e.var62=window.Detectizr.os.name),"undefined"!==window.Detectizr.os.version&&(e.var61=window.Detectizr.os.version)),e},setFromMetaTags:function(){var e,t=document.getElementsByTagName("META");if(l.scqs.originaltitle)l.originalHeadline=l.scqs.orginaltitle;else{for(e=0;e<t.length;e++)"original-headline"===t[e].name&&(l.originalHeadline=t[e].content);CBC.APP.SC["original-headline"]&&(l.originalHeadline=CBC.APP.SC["original-headline"],l.originalHeadline=l.originalHeadline.replace(/\s/g,"-"),l.originalHeadline=l.originalHeadline.toLowerCase())}if("string"==typeof l.scqs.keywords)d.list1=l.scqs.keywords.replace(/, /g,",").replace(/\s/g,"-").toLowerCase();else if("object"===_typeof(l.scqs.keywords))d.list1=this.parseKeywords(l.scqs.keywords);else for(e=0;e<t.length;e++)"keywords"===t[e].name&&(d.list1=t[e].content.replace(/, /g,",").replace(/\s/g,"-").toLowerCase());l.scqs.experiments&&l.scqs.experiments.content&&(d.list3=l.scqs.experiments.content.trim()),d.list2=l.scqs.authors?l.scqs.authors.replace(/, /g,",").replace(/\s/g,"-").toLowerCase():void 0,l.scqs.syndicate?d.prop66=u.normalize(l.scqs.syndicate):CBC.APP.SC.syndicate?d.prop66=u.normalize(CBC.APP.SC.syndicate):d.prop66="cbcca-web"},setWordCount:function(){CBC.APP.SC.DTM.formatted.adobe.wordcount&&["story","segment","blogentry"].includes(CBC.APP.SC.DTM.DATA.contenttype)&&(d.prop7=CBC.APP.SC.DTM.formatted.adobe.wordcount)},setContentVars:function(){if(l.scqs.author&&(d.prop25=l.scqs.author),l.scqs.title&&l.scqs.pubdate&&l.scqs.contentid){var e,t=new Date(parseInt(l.scqs.pubdate)),i=t.getUTCDate();i<10&&(i="0"+i);var n=t.getUTCMonth()+1;n<10&&(n="0"+n),e=t.getUTCFullYear()+"/"+n+"/"+i+"/"+l.scqs.contentid,d.prop27=e+":"+l.scqs.title}l.scqs.section&&(d.prop26=l.scqs.section,l.subsection.push(l.scqs.section)),l.scqs.sitename&&(d.prop26=l.scqs.sitename),l.scqs.postdate&&(d.prop28=l.scqs.postdate)},getUrl:function(){var e="";if(e=CBC.APP.SC.url?CBC.APP.SC.url:l.scqs.url?decodeURIComponent(l.scqs.url):window.location.href,!u.isExternallyHosted()){var t=e.indexOf("#");-1!==t&&(e=e.substring(0,t));var i=e.indexOf("?");-1!==i&&(e=e.substring(0,i))}l.pageurl=e},removeDomain:function(e){return e.replace(/https?:\/\/.*?cbc(music)?\.ca(:.*?)*\//,"")},setSubsectionVars:function(){for(var e=0;e<3;e++)if(l.subsection[e]){var t=l.subsection.slice(0,e+1);d["prop"+(e+1)]=l.channel+":"+t.join(":")}},clearVariables:function(){try{u.console("before clearing variables",s_cbc_sitecatalyst);var e=l.pageviewcount;(l=[]).pageviewcount=e,t(),delete window.s_cbc_sitecatalyst.pageName,window.s_cbc_sitecatalyst.clearVars(),u.console("after clearing variables",s_cbc_sitecatalyst)}catch(e){console.log(e)}},copyPropsToEvars:function(){d.prop1&&!d.eVar1&&(d.eVar1="D=c1"),d.prop2&&!d.eVar2&&(d.eVar2="D=c2"),d.prop3&&!d.eVar3&&(d.eVar3="D=c3"),d.prop4&&!d.eVar4&&(d.eVar4="D=c4"),d.prop5&&!d.eVar5&&(d.eVar5="D=c5"),d.prop6&&!d.eVar6&&(d.eVar6="D=c6"),d.prop7&&!d.eVar7&&(d.eVar7="D=c7"),d.prop8&&!d.eVar8&&(d.eVar8="D=c8"),d.prop9&&!d.eVar9&&(d.eVar9="D=c9"),d.prop10&&!d.eVar10&&(d.eVar10="D=c10"),d.pageName&&!d.eVar11&&(d.eVar11="D=pageName"),d.channel&&!d.eVar12&&(d.eVar12="D=ch"),d.prop13&&!d.eVar13&&(d.eVar13="D=c13"),d.prop15&&!d.eVar15&&(d.eVar15="D=c15"),d.prop16&&!d.eVar16&&(d.eVar16="D=c16"),d.prop17&&!d.eVar17&&(d.eVar17="D=c17"),d.prop18&&!d.eVar18&&(d.eVar18="D=c18"),d.prop25&&!d.eVar25&&(d.eVar25="D=c25"),d.prop26&&!d.eVar26&&(d.eVar26="D=c26"),d.prop27&&!d.eVar27&&(d.eVar27="D=c27"),d.prop28&&!d.eVar28&&(d.eVar28="D=c28"),d.prop35&&!d.eVar35&&(d.eVar35="D=c35"),d.prop36&&!d.eVar36&&(d.eVar36="D=c36"),d.prop37&&!d.eVar37&&(d.eVar37="D=c37"),d.prop40&&!d.eVar40&&(d.eVar40="D=c40"),d.prop41&&!d.eVar41&&(d.eVar41="D=c41"),d.prop42&&!d.eVar42&&(d.eVar42="D=c42"),d.prop44&&!d.eVar44&&(d.eVar44="D=c44"),d.prop45&&!d.eVar45&&(d.eVar45="D=c45"),d.prop46&&!d.eVar46&&(d.eVar46="D=c46"),d.prop47&&!d.eVar47&&(d.eVar47="D=c47"),d.prop48&&!d.eVar48&&(d.eVar48="D=c48"),d.prop51&&!d.eVar51&&(d.eVar51="D=c51"),d.prop52&&!d.eVar52&&(d.eVar52="D=c52"),d.prop53&&!d.eVar53&&(d.eVar53="D=c53"),d.prop58&&!d.eVar58&&(d.eVar58="D=c58"),d.prop60&&!d.eVar60&&(d.eVar60="D=c60"),d.prop61&&!d.eVar61&&(d.eVar61="D=c61"),d.prop62&&!d.eVar62&&(d.eVar62="D=c62"),d.prop63&&!d.eVar63&&(d.eVar63="D=c63"),d.prop64&&!d.eVar64&&(d.eVar64="D=c64"),d.prop65&&!d.eVar65&&(d.eVar65="D=c65"),d.prop66&&!d.eVar66&&(d.eVar66="D=c66"),d.prop67&&!d.eVar67&&(d.eVar67="D=c67"),d.prop69&&!d.eVar69&&(d.eVar69="D=c69"),d.prop70&&!d.eVar70&&(d.eVar70="D=c70"),d.prop73&&!d.eVar73&&(d.eVar73="D=c73")},buildPageName:function(){var e=l.subsection.join(l.separator),t=[];0<arguments.length&&(t=u.arrayFromArguments(arguments)),t[0]&&u.typecheck(t[0]).array&&0<t[0].length&&(t=t[0]),0<l.subsection.length&&t.splice(0,0,e),t.splice(0,0,l.channel);for(var i=t.length;0<=i;i--){if(t[i]&&void 0!==l.scqs.contentid&&t[i]===d.prop5&&l.scqs.pubdate&&l.scqs.contenttype){var n=new Date(parseInt(l.scqs.pubdate)),r=n.getUTCDate();r<10&&(r="0"+r);var a=n.getUTCMonth()+1;a<10&&(a="0"+a),t[i]=n.getUTCFullYear()+"-"+a+"-"+r+"-"+l.scqs.contentid+"-"+t[i];break}if(t[i]&&void 0!==l.scqs.contentid&&t[i]===d.prop5&&l.scqs.contenttype){t[i]=l.scqs.contentid+"-"+t[i];break}}return(CBC.APP.SC.PageTracker.objEmpty(l.scqs)&&!l.directory?"misc:"+l.pageurl.replace(/:/g,"-"):t.join(l.separator)).toLowerCase().replace(/\s/g,"-")},conditionalEqualInArray:function(e,t){for(var i=e.length,n=0;n<i;n++)if(e[n]===t)return!0;return!1},getPageName:function(){return l.pageName},setPageName:function(){if("page"!==l.contenttype){this.conditionalEqualInArray(["story","episode","segment","feature","blogentry","media","authorbio","riding","image","link","photogallery","stub","bio","recipe"],l.contenttype)&&l.scqs.title?this.handleStory():"videoclip"!==l.contenttype&&"audioclip"!==l.contenttype||!l.scqs.title?"error"===l.contenttype?this.handleErrorPage():"index"===l.contenttype?this.handleIndexPage():this.handleOtherContent():this.handleVideoClip()}else"page"===l.contenttype&&this.handleGenericPage();return l.pageName},setTitle:function(){l.scqs.title&&!d.prop5&&(l.scqs.title=l.scqs.title.replace(/\//g,"-"),d.prop5=l.scqs.title)},setSponsor:function(){l.scqs.sponsor&&l.scqs.sponsor.name&&(CBC.APP.SC.UTIL.getMetadataWhitelist().metadata.whitelist.sponsor.name[l.scqs.sponsor.name]?d.prop51=l.scqs.sponsor.name:delete l.scqs.sponsor)},setContentPartner:function(){l.scqs.partner&&l.scqs.partner.name&&CBC.APP.SC.UTIL.getMetadataWhitelist().metadata.whitelist.partner.name[l.scqs.partner.name]&&(d.prop52=l.scqs.partner.name)},handleStory:function(){if(CBC.APP.SC.storyTitle&&(d.prop5=CBC.APP.SC.storyTitle,l.originalHeadline)){var e=l.scqs.title.split("-",1);l.scqs.title=e+"-"+l.originalHeadline}l.scqs.originaltitle&&(l.scqs.title=l.scqs.originaltitle),l.scqs.title=l.scqs.title.replace(/\//g,"-").replace(/\s/g,"-").toLowerCase(),d.prop5||(d.prop5=l.scqs.title),l.pageName=this.buildPageName(l.contenttype,l.scqs.title),d.prop11="D=pageName",l.hier1=this.getHierarchy()},handleVideoClip:function(){this.setTitle(),l.pageName=this.buildPageName(l.contenttype,l.scqs.title),l.hier1=this.getHierarchy()},handleErrorPage:function(){d.pageType="errorPage",l.pageName=this.buildPageName(),l.hier1=this.getHierarchy()},handleIndexPage:function(){l.pageName=this.buildPageName("index"),l.hier1=this.getHierarchy()},handleOtherContent:function(){l.contenttype?(l.pageName=this.buildPageName(l.contenttype),"audioclip"===l.contenttype&&this.setTitle()):l.pageName=this.buildPageName(),l.hier1=this.getHierarchy()},handleGenericPage:function(){var e=[];if(this.objEmpty(l.scqs)&&l.directory){e.push(l.directory);var t=this.getSubFolders(l.directory);""!==t&&e.push(t)}var i=this.getCurrentFile();"cbc"===i||"web"===i||l.scqs.filename||e.push(i),0<e.length?l.pageName=this.buildPageName(e):l.pageName=this.buildPageName(),l.hier1=this.getHierarchy(l.directory)},getHierarchy:function(e){if(0===l.subsection.length)return l.channel;var t=l.subsection.join(","),i=l.channel+","+t;return e&&(i+=","+e),i},registerPageView:function(){this.copyPropsToEvars(),d.campaign||(d.campaign=d.Util.getQueryParam("cmp")),d.campaign=d.getValOnce(d.campaign,"s_campaign",0),d.hbx_lt="auto",d.events=d.apl(d.events,"event2",",",2),d.prop71="undefined"!=typeof Visitor?"VisitorAPI Present":"VisitorAPI Missing",d.t()},getSubFolders:function(e){var t=l.pageurl,i=new RegExp(e+"\\/(.*)\\/"),n=t.match(i);return n&&2===n.length?n[1].replace("/",l.separator):""},getCurrentFile:function(){var e=l.pageurl.match(/.*\/([^?#]*)/)[1];return""!==e?e:"index.html"},getVal:function(e){return l[e]},objEmpty:function(e){for(var t in e)if("function"!=typeof e[t])return!1;return!0},setSearchPrefix:function(){0<window.location.port.length?l.searchprefix="cbc.ca:"+window.location.port+"/":l.searchprefix="cbc.ca/"},getUserSegmentation:function(){var e=this.isLoggedIn()?"loggedin":"anonymous",t=this.isCommentor()?"commentor":"";return e+(t?" | "+t:"")},isLoggedIn:function(){try{return"guest"!==window.viafoura.users.current().user_privilege}catch(e){return!1}},isCommentor:function(){try{return 0<window.viafoura.users.current().comments_made}catch(e){return!1}},setDateVars:function(){var e=this.getDateVars();void 0!==e.var13&&(d.prop13=e.var13)},getDateVars:function(){var e={};if(!/^(index|bio)$/i.test(l.scqs.contenttype)){var t,i=new RegExp("^\\d+$");i.test(CBC.APP.SC.publishedTime)?t=CBC.APP.SC.publishedTime:l.scqs.pubdate&&i.test(l.scqs.pubdate)?t=l.scqs.pubdate:void 0!==l.scqs.pubdate&&(t="Incorrect date format received: "+l.scqs.pubdate),e.var13=t}return e},exitSPA:function(){return!(l.pageviewcount=0)},parseKeywords:function(e){var t=0,i=0,n=[];if("object"!==_typeof(e))return"";for(t=0;t<e.length;t++)for(i=0;i<e[t].entities.length;i++)n.push(e[t].name+":"+e[t].entities[i].name);return n.join([","]).toLowerCase().replace(/\s/g,"-")},checkStatsVersions:function(e,t){var i=(e===t)+":"+e+":"+t;return d.prop70=i}}}(),CBC.APP.SC.preventDefault||CBC.APP.SC.DTM.DATA.preventDefault?CBC.APP.SC.UTIL.console("Warning: Not firing page tracking on page load"):CBC.APP.SC.PageTracker.init(),function(){if(document.getElementById("cbc-as-search-root")){var e=document.createElement("link");e.rel="stylesheet",e.id="cbc-as-search-css",e.href="/search-assets/static/css/cbc-as-search.css",document.head.appendChild(e);var t=document.createElement("script");t.type="text/javascript",t.id="cbc-as-search-js",t.src="/search-assets/static/js/cbc-as-search.js",document.body.appendChild(t)}}(),function(n){function e(e,t){var i=window.document.createElement("iframe");i.setAttribute("src","/g/stats/html/cmf.html?a="+e+"&m="+t+"&s=cbc&p="+encodeURIComponent(n.location.href)),i.setAttribute("id","cmf-iframe"),i.setAttribute("width","0"),i.setAttribute("height","0"),i.setAttribute("frameBorder","0"),document.body.appendChild(i)}n.CBC||(n.CBC={}),n.CBC.APP||(n.CBC.APP={}),n.CBC.APP.SC||(n.CBC.APP.SC={}),n.CBC.APP.SC.DTM||(n.CBC.APP.SC.DTM={}),n.CBC.APP.SC.DTM.DATA||(n.CBC.APP.SC.DTM.DATA={}),document.getElementById("cmf-iframe")&&document.getElementById("cmf-iframe").remove();var t,i={"cbc.ca\\/xcompany\\/debriefing":"1415.11316.140589","cbc.ca\\/bellevue\\/videos\\/1994-videos":"1617.11311.146736","cbc.ca\\/kidscbc1\\/shows\\/chirp":"1213.11116.133491","cbc.ca\\/covermecanada":"1112.11416.132002","cbc.ca\\/player\\/tv\\/Halifax%20Comedy%20Festival\\/Season%2019":"1415.11453.141153","cbc.ca\\/kidscbcolympics":"1617.11116.144982","cbc.ca\\/murdochmysteries\\/onthecase":"1516.11316.142584","cbc.ca\\/murdochmysteries\\/noqs":"1213.11316.132929","cbc.ca\\/murdochmysteries\\/videos\\/making-murdoch\\/\\S+":"1314.11313.138117","cbc.ca\\/murdochmysteries\\/theinfernaldevice":"1415.11353.141147","cbc.ca\\/overtherainbow":"1213.11416.133409","cbc.ca\\/republicofdoyle\\/episodes\\/season-5\\/\\S+":"1314.11313.138147","cbc.ca\\/thebestlaidplans\\/videos\\/the-petes-laid-plans\\/\\S+":"1314.11313.138145","cbc.ca\\/22minutes\\/videos\\/22-minutes-update\\/\\S+":"1516.11353.142570","cbc.ca\\/thislife\\/videos\\/exclusives\\/\\S+":"1516.11313.142585","cbc.ca\\/workinmoms\\/videos\\/season-1\\/\\S+":"1617.11353.145375","cbc.ca\\/xcompany\\/videos\\/x-company-animated\\/\\S+":"1516.11313.142581","cbc.ca\\/shootthemessenger\\/murderboard":"1516.11315.142932","cbc.ca\\/arcticair\\/videos\\/man-of-the-north":"1112.11316.131909","cbc.ca\\/michael\\/videos\\/lost-therapy-tapes":"1112.11316.131239","cbc.ca\\/michael\\/videos\\/after-the-beep":"1112.11316.131239","comedycoup.cbc.ca\\/cc\\/canada-2014":"1415.11316.139499","cbc.ca\\/mrd\\/videos\\/xavier-gazette":"1112.11316.131856","cbc.ca\\/insecurity":"1011.11316.128616"};Object.keys(i).some(function(e){return!!new RegExp(e).test(n.location.href)&&(t=i[e],!0)})?e(t,n.document.title):n.CBC.APP.SC.DTM.DATA&&n.CBC.APP.SC.DTM.DATA.cmfAppId&&e(n.CBC.APP.SC.DTM.DATA.cmfAppId,n.CBC.APP.SC.DTM.DATA.title)}(window._window||window);